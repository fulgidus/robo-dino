(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let r;const N=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&N.decode();let m=null;function Z(){return(m===null||m.byteLength===0)&&(m=new Uint8Array(r.memory.buffer)),m}function $(e,t){return e=e>>>0,N.decode(Z().subarray(e,e+t))}let x=null;function Y(){return(x===null||x.byteLength===0)&&(x=new Float32Array(r.memory.buffer)),x}function T(e,t){return e=e>>>0,Y().subarray(e/4,e/4+t)}let v=null;function tt(){return(v===null||v.byteLength===0)&&(v=new Uint32Array(r.memory.buffer)),v}function et(e,t){return e=e>>>0,tt().subarray(e/4,e/4+t)}let q=0;function nt(e,t){const n=t(e.length*4,4)>>>0;return Y().set(e,n/4),q=e.length,n}typeof FinalizationRegistry>"u"||new FinalizationRegistry(e=>r.__wbg_obstacle_free(e>>>0,1));const j=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_world_free(e>>>0,1));class ot{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_world_free(t,0)}constructor(){const t=r.world_new();return this.__wbg_ptr=t>>>0,j.register(this,this.__wbg_ptr,this),this}update(t){r.world_update(this.__wbg_ptr,t)}get_best_dino_x(){return r.world_get_best_dino_x(this.__wbg_ptr)}get_best_dino_y(){return r.world_get_best_dino_y(this.__wbg_ptr)}export_velocity(){const t=r.world_export_velocity(this.__wbg_ptr);var n=T(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}export_velocity_ptr(){return r.world_export_velocity_ptr(this.__wbg_ptr)>>>0}get_best_dino_velocity_y(){return r.world_get_best_dino_velocity_y(this.__wbg_ptr)}get_best_score(){return r.world_get_best_score(this.__wbg_ptr)>>>0}get_generation(){return r.world_get_generation(this.__wbg_ptr)>>>0}get_obstacle_count(){return r.world_get_obstacle_count(this.__wbg_ptr)>>>0}get_obstacle_x(t){return r.world_get_obstacle_x(this.__wbg_ptr,t)}get_fitness_history(){const t=r.world_get_fitness_history(this.__wbg_ptr);var n=et(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_score_of(t){return r.world_get_score_of(this.__wbg_ptr,t)>>>0}get_best_input_weights(){const t=r.world_get_best_input_weights(this.__wbg_ptr);var n=T(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_best_output_weights(){const t=r.world_get_best_output_weights(this.__wbg_ptr);var n=T(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_best_bias(){return r.world_get_best_bias(this.__wbg_ptr)}set_best_weights(t){const n=nt(t,r.__wbindgen_malloc),c=q;r.world_set_best_weights(this.__wbg_ptr,n,c)}set_best_bias(t){r.world_set_best_bias(this.__wbg_ptr,t)}count_alive(){return r.world_count_alive(this.__wbg_ptr)>>>0}get_average_score(){return r.world_get_average_score(this.__wbg_ptr)}is_alive(t){return r.world_is_alive(this.__wbg_ptr,t)!==0}get_population_size(){return r.world_get_population_size(this.__wbg_ptr)>>>0}get_dino_x(t){return r.world_get_dino_x(this.__wbg_ptr,t)}get_dino_y(t){return r.world_get_dino_y(this.__wbg_ptr,t)}}async function rt(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(c){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function st(){const e={};return e.wbg={},e.wbg.__wbg_log_c222819a41e063d3=function(t){console.log(t)},e.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_export_0,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_string_new=function(t,n){return $(t,n)},e.wbg.__wbindgen_throw=function(t,n){throw new Error($(t,n))},e}function it(e,t){return r=e.exports,H.__wbindgen_wasm_module=t,x=null,v=null,m=null,r.__wbindgen_start(),r}async function H(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/robo-dino/assets/rust_dino_bg-BvGdgbYa.wasm",import.meta.url));const t=st();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:c}=await rt(await e,t);return it(n,c)}function ct(e){return 1/(1+Math.exp(-e))}let a;const P=document.getElementById("main"),d=P.getContext("2d"),A=document.getElementById("fitness"),y=A.getContext("2d");let k=[];const M=document.getElementById("weightsCanvas"),z=M.getContext("2d"),E=document.getElementById("neuralNet"),f=E.getContext("2d");function _t(e){const t=(e+1)/2,n=Math.floor(t*255),c=Math.floor((1-t)*255);return`rgb(${n}, 0, ${c})`}function lt(){const e=a.get_best_input_weights(),t=3,n=Math.ceil(e.length/t),c=M.width/n,i=M.height/t;z.clearRect(0,0,M.width,M.height);for(let s=0;s<e.length;s++){const u=Math.floor(s/n),g=s%n;z.fillStyle=_t(e[s]),z.fillRect(g*c,u*i,c,i)}}function C(e,t,n,c,i,s){f.beginPath(),f.arc(e,t,n,0,2*Math.PI),f.fillStyle=c,f.fill(),f.strokeStyle="black",f.stroke(),f.fillStyle="black",f.font="10px monospace",f.fillText(`${i}`,e-n,t-n-2),f.fillText(s.toFixed(2),e-n+3,t+4)}function D(e,t,n,c,i){const s=Math.max(-1,Math.min(1,i)),u=Math.floor(Math.abs(s)*255),g=s>=0?`rgb(${u},0,0)`:`rgb(${u/2},${u/2},${u})`;f.strokeStyle=g,f.lineWidth=1+Math.abs(s)*2,f.beginPath(),f.moveTo(e,t),f.lineTo(n,c),f.stroke()}function at(){f.clearRect(0,0,E.width,E.height);const e=["Dist.","Vert. Speed","Horiz. Speed"],t=a.get_best_input_weights(),n=a.get_best_output_weights(),c=a.get_best_bias(),i=n.length,s=e.length,u=18,g=[],b=[],W=a.get_best_dino_x(),R=a.get_best_dino_velocity_y();let w=1/0;for(let o=0;o<a.get_obstacle_count();o++){const l=a.get_obstacle_x(o)-W;l>0&&l<w&&(w=l)}const G=w,X=R,J=(a.get_best_score()+1)/100,L=[G,X,J];function O(o,_,l=!1){const h=l?1:o%2,p=l?o+.5:Math.floor(o/2);return[_+h*40,50+p*60]}for(let o=0;o<s;o++){const[_,l]=O(o,50,!0);g.push({x:_,y:l})}for(let o=0;o<i;o++){const[_,l]=O(o,300,!0);b.push({x:_,y:l})}const I=510,B=120;for(let o=0;o<i;o++)for(let _=0;_<s;_++){const l=g[_],h=b[o],p=t[o*s+_];D(l.x,l.y,h.x,h.y,p)}for(let o=0;o<i;o++){const _=b[o];D(_.x,_.y,I,B,n[o])}const F=[];for(let o=0;o<i;o++){const _=L.reduce((h,p,U)=>h+p*t[o*s+U],0),l=1/(1+Math.exp(-_));F.push(l)}const K=F.reduce((o,_,l)=>o+_*n[l],0)+c,Q=ct(K);for(let o=0;o<s;o++){const{x:_,y:l}=g[o];C(_,l,u,"lightblue",e[o],L[o])}for(let o=0;o<i;o++){const{x:_,y:l}=b[o];C(_,l,u,"teal","",F[o])}C(I,B,u,"violet","Jump",Q)}function gt(){const e=P.width,t=P.height;d.clearRect(0,0,e,t),d.fillStyle="brown",d.fillRect(0,t-20,e,20);const n=a.get_population_size?.()??1,c=20;for(let g=0;g<n;g++){const b=a.get_dino_x(g),W=a.get_dino_y(g),R=a.is_alive(g),w=t-20-W-c;d.fillStyle=R?"green":"transparent",d.fillRect(b,w,c,c),d.strokeStyle=R?"white":"transparent",d.lineWidth=1,d.strokeRect(b,w,c,c)}for(let g=0;g<a.get_obstacle_count();g++){const b=a.get_obstacle_x(g);d.fillStyle="red",d.fillRect(b,t-20-30,5,30)}const i=a.get_best_score(),s=a.count_alive(),u=a.get_generation();d.fillStyle="black",d.font="14px monospace",d.fillText(`Score: ${i}`,10,20),d.fillText(`Alive: ${s}`,100,20),d.fillText(`Generation: ${u}`,350,20)}function ut(e){y.clearRect(0,0,A.width,A.height);const t=Math.max(...e,10),n=A.width,c=A.height;y.beginPath(),y.moveTo(0,c),e.forEach((i,s)=>{const u=s/e.length*n,g=c-i/t*c;y.lineTo(u,g)}),y.strokeStyle="blue",y.stroke()}function V(e){if(S||a.update(1/60),gt(),lt(),ut(k),at(),!S){const t=a.get_best_score();k.push(t)}requestAnimationFrame(()=>V())}H().then(e=>{a=new ot,requestAnimationFrame(()=>V(e.memory.buffer))});let S=!1;document.getElementById("togglePause").addEventListener("click",()=>{S=!S;const e=document.getElementById("togglePause");e.textContent=S?"▶️ Resume":"⏸️ Pause"});
