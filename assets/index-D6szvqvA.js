(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const _ of i.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function n(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(l){if(l.ep)return;l.ep=!0;const i=n(l);fetch(l.href,i)}})();let s;const Q=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Q.decode();let I=null;function ue(){return(I===null||I.byteLength===0)&&(I=new Uint8Array(s.memory.buffer)),I}function J(e,t){return e=e>>>0,Q.decode(ue().subarray(e,e+t))}let C=null;function de(){return(C===null||C.byteLength===0)&&(C=new Uint32Array(s.memory.buffer)),C}function fe(e,t){return e=e>>>0,de().subarray(e/4,e/4+t)}let W=null;function Z(){return(W===null||W.byteLength===0)&&(W=new Float32Array(s.memory.buffer)),W}function z(e,t){return e=e>>>0,Z().subarray(e/4,e/4+t)}let X=0;function be(e,t){const n=t(e.length*4,4)>>>0;return Z().set(e,n/4),X=e.length,n}typeof FinalizationRegistry>"u"||new FinalizationRegistry(e=>s.__wbg_obstacle_free(e>>>0,1));const V=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>s.__wbg_world_free(e>>>0,1));class ee{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,V.unregister(this),t}free(){const t=this.__destroy_into_raw();s.__wbg_world_free(t,0)}constructor(t){const n=s.world_new(t);return this.__wbg_ptr=n>>>0,V.register(this,this.__wbg_ptr,this),this}update(t){s.world_update(this.__wbg_ptr,t)}get_best_dino_x(){return s.world_get_best_dino_x(this.__wbg_ptr)}get_best_dino_y(){return s.world_get_best_dino_y(this.__wbg_ptr)}get_best_dino_velocity_y(){return s.world_get_best_dino_velocity_y(this.__wbg_ptr)}get_best_index(){return s.world_get_best_index(this.__wbg_ptr)>>>0}get_best_score(){return s.world_get_best_score(this.__wbg_ptr)>>>0}get_generation(){return s.world_get_generation(this.__wbg_ptr)>>>0}get_obstacle_count(){return s.world_get_obstacle_count(this.__wbg_ptr)>>>0}get_obstacle_x(t){return s.world_get_obstacle_x(this.__wbg_ptr,t)}get_fitness_history(){const t=s.world_get_fitness_history(this.__wbg_ptr);var n=fe(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*4,4),n}get_score_of(t){return s.world_get_score_of(this.__wbg_ptr,t)>>>0}get_best_input_weights(){const t=s.world_get_best_input_weights(this.__wbg_ptr);var n=z(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*4,4),n}get_best_output_weights(){const t=s.world_get_best_output_weights(this.__wbg_ptr);var n=z(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*4,4),n}get_best_bias(){return s.world_get_best_bias(this.__wbg_ptr)}set_best_weights(t){const n=be(t,s.__wbindgen_malloc),o=X;s.world_set_best_weights(this.__wbg_ptr,n,o)}set_best_bias(t){s.world_set_best_bias(this.__wbg_ptr,t)}count_alive(){return s.world_count_alive(this.__wbg_ptr)>>>0}get_average_score(){return s.world_get_average_score(this.__wbg_ptr)}is_alive(t){return s.world_is_alive(this.__wbg_ptr,t)!==0}get_best_hidden_biases(){const t=s.world_get_best_hidden_biases(this.__wbg_ptr);var n=z(t[0],t[1]).slice();return s.__wbindgen_free(t[0],t[1]*4,4),n}get_population_size(){return s.world_get_population_size(this.__wbg_ptr)>>>0}get_dino_x(t){return s.world_get_dino_x(this.__wbg_ptr,t)}get_dino_y(t){return s.world_get_dino_y(this.__wbg_ptr,t)}get_speed_multiplier(){return s.world_get_speed_multiplier(this.__wbg_ptr)}}async function he(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(o){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function we(){const e={};return e.wbg={},e.wbg.__wbg_error_524f506f44df1645=function(t){console.error(t)},e.wbg.__wbg_log_c222819a41e063d3=function(t){console.log(t)},e.wbg.__wbg_warn_4ca3906c248c47c4=function(t){console.warn(t)},e.wbg.__wbindgen_init_externref_table=function(){const t=s.__wbindgen_export_0,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_string_new=function(t,n){return J(t,n)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(J(t,n))},e}function pe(e,t){return s=e.exports,te.__wbindgen_wasm_module=t,W=null,C=null,I=null,s.__wbindgen_start(),s}async function te(e){if(s!==void 0)return s;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/robo-dino/assets/rust_dino_bg-D6h-wNSk.wasm",import.meta.url));const t=we();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await he(await e,t);return pe(n,o)}let c,ne=1,T=200,ie=!0,oe=!0,D=0;const U=document.getElementById("main"),d=U.getContext("2d"),k=document.getElementById("fitness"),M=k.getContext("2d");let j=[];const E=document.getElementById("weightsCanvas"),O=E.getContext("2d"),P=document.getElementById("neuralNet"),b=P.getContext("2d"),re="rgb(173, 216, 230)",se="rgb(0, 128, 128)",le="rgb(238, 130, 238)";function G(e){return 1/(1+Math.exp(-e))}function ye(e,t,n){let o=0,l=0,i=0,_=0,f=0,h=0;try{const y=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(y)[o,l,i]=y.slice(1).map(Number);else return e;t==="white"&&([_,f,h]=[255,255,255])}catch(y){return console.error("Color parsing/interpolation failed",y),e}const g=Math.round(o+(_-o)*n),w=Math.round(l+(f-l)*n),p=Math.round(i+(h-i)*n);return`rgb(${g}, ${w}, ${p})`}function me(e){const t=(e+1)/2,n=Math.floor(t*255),o=Math.floor((1-t)*255);return`rgb(${n}, 0, ${o})`}function ve(){const e=c.get_best_input_weights(),t=3,n=Math.ceil(e.length/t),o=E.width/n,l=E.height/t;O.clearRect(0,0,E.width,E.height);for(let i=0;i<e.length;i++){const _=Math.floor(i/n),f=i%n;O.fillStyle=me(e[i]),O.fillRect(f*o,_*l,o,l)}}function $(e,t,n,o,l,i,_,f,h){const g=Math.max(0,Math.min(1,f)),w=.005,y=o*.2*g,S=o+y*Math.sin(w*h),A=g*.3,m=ye(l,"white",A);e.beginPath(),e.arc(t,n,S,0,2*Math.PI),e.fillStyle=m,e.fill(),e.strokeStyle="black",e.lineWidth=1,e.stroke(),e.fillStyle="black",e.font="10px monospace",e.textAlign="center",e.fillText(`${i}`,t,n-S-5),e.fillText(_.toFixed(2),t,n+4),e.textAlign="start"}function K(e,t,n,o,l){const i=Math.max(-1,Math.min(1,l)),_=Math.floor(Math.abs(i)*255),f=i>=0?`rgb(${_},0,0)`:`rgb(${_/2},${_/2},${_})`;b.strokeStyle=f,b.lineWidth=1+Math.abs(i)*2,b.beginPath(),b.moveTo(e,t),b.lineTo(n,o),b.stroke()}function Se(e,t,n){const o="10px monospace";let i=n;e.fillStyle="black",e.font=o,e.fillText("Legend:",t,i),i+=12*1.5,e.fillText("Connections:",t,i),i+=12,e.strokeStyle="rgb(255,0,0)",e.lineWidth=1+1*2,e.beginPath(),e.moveTo(t,i),e.lineTo(t+20,i),e.stroke(),e.fillStyle="black",e.fillText("+ Weight (Intensity)",t+25,i+3),i+=12,e.strokeStyle="rgb(127,127,255)",e.lineWidth=1+1*2,e.beginPath(),e.moveTo(t,i),e.lineTo(t+20,i),e.stroke(),e.fillStyle="black",e.fillText("- Weight (Intensity)",t+25,i+3),i+=12*1.5,e.fillText("Neurons:",t,i),i+=12,e.fillStyle=re,e.beginPath(),e.arc(t+10,i,5,0,2*Math.PI),e.fill(),e.fillStyle="black",e.fillText("Input",t+25,i+3),i+=12,e.fillStyle=se,e.beginPath(),e.arc(t+10,i,5,0,2*Math.PI),e.fill(),e.fillStyle="black",e.fillText("Hidden",t+25,i+3),i+=12,e.fillStyle=le,e.beginPath(),e.arc(t+10,i,5,0,2*Math.PI),e.fill(),e.fillStyle="black",e.fillText("Output (Jump)",t+25,i+3),i+=12*1.5,e.fillText("Neuron activation:",t,i),i+=12,e.fillText("Pulsing/luminosity",t+5,i),i+=12,e.fillText("= Neuron output",t+5,i),e.strokeStyle="black",e.lineWidth=1}function Ae(e){b.clearRect(0,0,P.width,P.height);const t=c.get_best_index();if(typeof t!="number"||t<0||t>=c.get_population_size()){console.warn("Invalid bestIndex received:",t),b.fillStyle="red",b.font="12px monospace",b.fillText("Waiting for best dino data...",10,20);return}const n=c.get_best_input_weights(),o=c.get_best_output_weights(),l=c.get_best_bias(),i=c.get_best_hidden_biases(),_=o.length,f=["Dist.","Speed Mult.","Score Norm."],h=f.length,g=18,w=[],p=[],y=c.get_dino_x(t),S=c.get_score_of(t),A=c.get_speed_multiplier();let m=1/0;const _e=5;for(let r=0;r<c.get_obstacle_count();r++){const a=c.get_obstacle_x(r);if(a+_e>y){const u=a-y;u<m&&(m=u)}}const L=[m===1/0?1e3:m,A,(S+1)/100];function N(r,a,u){const v=(u-1)*60,H=(P.height-v)/2+r*60;return[a,H]}for(let r=0;r<h;r++){const[a,u]=N(r,50,h);w.push({x:a,y:u})}for(let r=0;r<_;r++){const[a,u]=N(r,180,_);p.push({x:a,y:u})}const[q,Y]=N(0,310,1);for(let r=0;r<_;r++)for(let a=0;a<h;a++){const u=w[a],v=p[r],x=n[r*h+a];K(u.x,u.y,v.x,v.y,x)}for(let r=0;r<_;r++){const a=p[r];K(a.x,a.y,q,Y,o[r])}const R=[];for(let r=0;r<_;r++){let a=L.reduce((v,x,H)=>v+x*n[r*h+H],0);a+=i[r];const u=G(a);R.push(u)}const ae=R.reduce((r,a,u)=>r+a*o[u],0)+l,B=G(ae);for(let r=0;r<h;r++){const{x:a,y:u}=w[r],v=Math.max(0,Math.min(1,L[r]));$(b,a,u,g,re,f[r],L[r],v,e)}for(let r=0;r<_;r++){const{x:a,y:u}=p[r];$(b,a,u,g,se,"",R[r],R[r],e)}const ge=B>.6?B:0;$(b,q,Y,g,le,"Jump",B,ge,e),Se(b,P.width-160,20)}function Me(){const e=U.width,t=U.height;d.clearRect(0,0,e,t),d.fillStyle="brown",d.fillRect(0,t-20,e,20);const n=c.get_population_size?.()??1,o=20,l=c.get_best_index?.(),i=typeof l=="number"&&l>=0;for(let g=0;g<n;g++){const w=c.is_alive(g);let p=!1;if(ie||(!i||g!==l)&&(p=!0),!p&&oe&&!w&&(p=!0),p)continue;const y=c.get_dino_x(g),S=c.get_dino_y(g),A=t-20-S-o,m="rgba(128, 128, 128, 0.05)";d.fillStyle=w?"green":m,d.fillRect(y,A,o,o),d.strokeStyle=w?"white":m,d.lineWidth=1,d.strokeRect(y,A,o,o)}for(let g=0;g<c.get_obstacle_count();g++){const w=c.get_obstacle_x(g);d.fillStyle="red",d.fillRect(w,t-20-30,5,30)}const _=c.get_best_score(),f=c.count_alive(),h=c.get_generation();d.fillStyle="black",d.font="14px monospace",d.fillText(`Score: ${_}`,10,20),d.fillText(`Alive: ${f}`,100,20),d.fillText(`Highest Score: ${D}`,200,20),d.fillText(`Generation: ${h}`,350,20)}function Te(e){M.clearRect(0,0,k.width,k.height);const t=Math.max(...e,10),n=k.width,o=k.height;M.beginPath(),M.moveTo(0,o),e.forEach((l,i)=>{const _=i/e.length*n,f=o-l/t*o;M.lineTo(_,f)}),M.strokeStyle="blue",M.stroke()}function ce(e,t){F||c.update(1/60*ne);const n=c.get_best_score();if(n>D&&(D=n),Me(),ve(),Te(j),Ae(e),!F){const o=c.get_best_score();j.push(o)}requestAnimationFrame(o=>ce(o))}te().then(e=>{c=new ee(T),requestAnimationFrame(t=>ce(t,e.memory.buffer))});let F=!1;document.getElementById("togglePause").addEventListener("click",()=>{F=!F;const e=document.getElementById("togglePause");e.textContent=F?"▶️ Resume":"⏸️ Pause"});document.getElementById("speed").addEventListener("input",e=>{ne=parseFloat(e.target.value)});document.getElementById("showAll").addEventListener("change",e=>{ie=e.target.checked});document.getElementById("showOnlyAlive").addEventListener("change",e=>{oe=e.target.checked});document.getElementById("applySettings").addEventListener("click",()=>{const e=document.getElementById("agents"),t=parseInt(e.value);!isNaN(t)&&t>0&&t!==T?(T=t,j=[],c=new ee(T),console.log(`Restarted with ${T} agents.`)):(isNaN(t)||t<=0)&&(console.warn("Invalid agent count specified."),e.value=T.toString())});
