(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const _ of s.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&c(_)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let r;const N=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&N.decode();let p=null;function Z(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(r.memory.buffer)),p}function B(e,t){return e=e>>>0,N.decode(Z().subarray(e,e+t))}let m=null;function tt(){return(m===null||m.byteLength===0)&&(m=new Uint32Array(r.memory.buffer)),m}function et(e,t){return e=e>>>0,tt().subarray(e/4,e/4+t)}let x=null;function q(){return(x===null||x.byteLength===0)&&(x=new Float32Array(r.memory.buffer)),x}function D(e,t){return e=e>>>0,q().subarray(e/4,e/4+t)}let Y=0;function nt(e,t){const n=t(e.length*4,4)>>>0;return q().set(e,n/4),Y=e.length,n}typeof FinalizationRegistry>"u"||new FinalizationRegistry(e=>r.__wbg_obstacle_free(e>>>0,1));const $=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_world_free(e>>>0,1));class ot{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,$.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_world_free(t,0)}constructor(){const t=r.world_new();return this.__wbg_ptr=t>>>0,$.register(this,this.__wbg_ptr,this),this}update(t){r.world_update(this.__wbg_ptr,t)}get_best_dino_x(){return r.world_get_best_dino_x(this.__wbg_ptr)}get_best_dino_y(){return r.world_get_best_dino_y(this.__wbg_ptr)}get_best_dino_velocity(){return r.world_get_best_dino_velocity(this.__wbg_ptr)}get_best_score(){return r.world_get_best_score(this.__wbg_ptr)>>>0}get_generation(){return r.world_get_generation(this.__wbg_ptr)>>>0}get_obstacle_count(){return r.world_get_obstacle_count(this.__wbg_ptr)>>>0}get_obstacle_x(t){return r.world_get_obstacle_x(this.__wbg_ptr,t)}get_fitness_history(){const t=r.world_get_fitness_history(this.__wbg_ptr);var n=et(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_score_of(t){return r.world_get_score_of(this.__wbg_ptr,t)>>>0}get_best_input_weights(){const t=r.world_get_best_input_weights(this.__wbg_ptr);var n=D(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_best_output_weights(){const t=r.world_get_best_output_weights(this.__wbg_ptr);var n=D(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_best_bias(){return r.world_get_best_bias(this.__wbg_ptr)}set_best_weights(t){const n=nt(t,r.__wbindgen_malloc),c=Y;r.world_set_best_weights(this.__wbg_ptr,n,c)}set_best_bias(t){r.world_set_best_bias(this.__wbg_ptr,t)}count_alive(){return r.world_count_alive(this.__wbg_ptr)>>>0}get_average_score(){return r.world_get_average_score(this.__wbg_ptr)}is_alive(t){return r.world_is_alive(this.__wbg_ptr,t)!==0}get_population_size(){return r.world_get_population_size(this.__wbg_ptr)>>>0}get_dino_x(t){return r.world_get_dino_x(this.__wbg_ptr,t)}get_dino_y(t){return r.world_get_dino_y(this.__wbg_ptr,t)}}async function rt(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(c){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function st(){const e={};return e.wbg={},e.wbg.__wbg_log_c222819a41e063d3=function(t){console.log(t)},e.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_export_0,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_string_new=function(t,n){return B(t,n)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(B(t,n))},e}function it(e,t){return r=e.exports,V.__wbindgen_wasm_module=t,x=null,m=null,p=null,r.__wbindgen_start(),r}async function V(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/robo-dino/assets/rust_dino_bg-DUPtSR06.wasm",import.meta.url));const t=st();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:c}=await rt(await e,t);return it(n,c)}function ct(e){return 1/(1+Math.exp(-e))}let g;const P=document.getElementById("main"),d=P.getContext("2d"),v=document.getElementById("fitness"),h=v.getContext("2d");let j=[];const M=document.getElementById("weightsCanvas"),T=M.getContext("2d"),z=document.getElementById("neuralNet"),u=z.getContext("2d");function _t(e){const t=(e+1)/2,n=Math.floor(t*255),c=Math.floor((1-t)*255);return`rgb(${n}, 0, ${c})`}function at(){const e=g.get_best_input_weights(),t=3,n=Math.ceil(e.length/t),c=M.width/n,i=M.height/t;T.clearRect(0,0,M.width,M.height);for(let s=0;s<e.length;s++){const _=Math.floor(s/n),f=s%n;T.fillStyle=_t(e[s]),T.fillRect(f*c,_*i,c,i)}}function C(e,t,n,c,i,s){u.beginPath(),u.arc(e,t,n,0,2*Math.PI),u.fillStyle=c,u.fill(),u.strokeStyle="black",u.stroke(),u.fillStyle="black",u.font="10px monospace",u.fillText(`${i}`,e-n,t-n-2),u.fillText(s.toFixed(2),e-n+3,t+4)}function k(e,t,n,c,i){const s=Math.max(-1,Math.min(1,i)),_=Math.floor(Math.abs(s)*255),f=s>=0?`rgb(${_},0,0)`:`rgb(${_/2},${_/2},${_})`;u.strokeStyle=f,u.lineWidth=1+Math.abs(s)*2,u.beginPath(),u.moveTo(e,t),u.lineTo(n,c),u.stroke()}function lt(){u.clearRect(0,0,z.width,z.height);const e=["Dist.","Vel.","Score"],t=g.get_best_input_weights(),n=g.get_best_output_weights(),c=g.get_best_bias(),i=n.length,s=e.length,_=18,f=[],b=[],S=g.get_best_dino_x(),R=g.get_best_dino_velocity?.()??0;let W=1/0;for(let o=0;o<g.get_obstacle_count();o++){const l=g.get_obstacle_x(o)-S;l>0&&l<W&&(W=l)}const X=Math.max(0,Math.min(1,(150-W)/150)),G=R/10,J=g.get_best_score()/100,E=[X,G,J];function L(o,a,l=!1){const w=l?1:o%2,y=l?o+.5:Math.floor(o/2);return[a+w*40,50+y*60]}for(let o=0;o<s;o++){const[a,l]=L(o,50,!0);f.push({x:a,y:l})}for(let o=0;o<i;o++){const[a,l]=L(o,300,!0);b.push({x:a,y:l})}const O=510,I=120;for(let o=0;o<i;o++)for(let a=0;a<s;a++){const l=f[a],w=b[o],y=t[o*s+a];k(l.x,l.y,w.x,w.y,y)}for(let o=0;o<i;o++){const a=b[o];k(a.x,a.y,O,I,n[o])}const F=[];for(let o=0;o<i;o++){const a=E.reduce((w,y,U)=>w+y*t[o*s+U],0),l=1/(1+Math.exp(-a));F.push(l)}const K=F.reduce((o,a,l)=>o+a*n[l],0)+c,Q=ct(K);for(let o=0;o<s;o++){const{x:a,y:l}=f[o];C(a,l,_,"lightblue",e[o],E[o])}for(let o=0;o<i;o++){const{x:a,y:l}=b[o];C(a,l,_,"teal","",F[o])}C(O,I,_,"violet","Jump",Q)}function gt(){const e=P.width,t=P.height;d.clearRect(0,0,e,t),d.fillStyle="brown",d.fillRect(0,t-20,e,20);const n=g.get_population_size?.()??1,c=20;for(let _=0;_<n;_++){const f=g.get_dino_x(_),b=g.get_dino_y(_),S=g.is_alive(_),R=t-20-b-c;d.fillStyle=S?"green":"transparent",d.fillRect(f,R,c,c),d.strokeStyle=S?"white":"transparent",d.lineWidth=1,d.strokeRect(f,R,c,c)}for(let _=0;_<g.get_obstacle_count();_++){const f=g.get_obstacle_x(_);d.fillStyle="red",d.fillRect(f,t-20-30,20,30)}const i=g.get_best_score(),s=g.count_alive();d.fillStyle="black",d.font="14px monospace",d.fillText(`Score: ${i}`,10,20),d.fillText(`Alive: ${s}`,100,20)}function ut(e){h.clearRect(0,0,v.width,v.height);const t=Math.max(...e,10),n=v.width,c=v.height;h.beginPath(),h.moveTo(0,c),e.forEach((i,s)=>{const _=s/e.length*n,f=c-i/t*c;h.lineTo(_,f)}),h.strokeStyle="blue",h.stroke()}function H(){if(A||g.update(1/60),gt(),at(),ut(j),lt(),!A){const e=g.get_best_score();j.push(e)}requestAnimationFrame(H)}V().then(()=>{g=new ot,requestAnimationFrame(H)});let A=!1;document.getElementById("togglePause").addEventListener("click",()=>{A=!A;const e=document.getElementById("togglePause");e.textContent=A?"▶️ Resume":"⏸️ Pause"});
