(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();let r;const F=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&F.decode();let u=null;function C(){return(u===null||u.byteLength===0)&&(u=new Uint8Array(r.memory.buffer)),u}function x(e,t){return e=e>>>0,F.decode(C().subarray(e,e+t))}let w=null;function L(){return(w===null||w.byteLength===0)&&(w=new Uint32Array(r.memory.buffer)),w}function O(e,t){return e=e>>>0,L().subarray(e/4,e/4+t)}let d=null;function W(){return(d===null||d.byteLength===0)&&(d=new Float32Array(r.memory.buffer)),d}function A(e,t){return e=e>>>0,W().subarray(e/4,e/4+t)}let M=0;function E(e,t){const n=t(e.length*4,4)>>>0;return W().set(e,n/4),M=e.length,n}typeof FinalizationRegistry>"u"||new FinalizationRegistry(e=>r.__wbg_obstacle_free(e>>>0,1));const R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_world_free(e>>>0,1));class U{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_world_free(t,0)}constructor(){const t=r.world_new();return this.__wbg_ptr=t>>>0,R.register(this,this.__wbg_ptr,this),this}update(t){r.world_update(this.__wbg_ptr,t)}get_best_dino_x(){return r.world_get_best_dino_x(this.__wbg_ptr)}get_best_dino_y(){return r.world_get_best_dino_y(this.__wbg_ptr)}get_best_score(){return r.world_get_best_score(this.__wbg_ptr)>>>0}get_generation(){return r.world_get_generation(this.__wbg_ptr)>>>0}get_obstacle_count(){return r.world_get_obstacle_count(this.__wbg_ptr)>>>0}get_obstacle_x(t){return r.world_get_obstacle_x(this.__wbg_ptr,t)}get_fitness_history(){const t=r.world_get_fitness_history(this.__wbg_ptr);var n=O(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_score_of(t){return r.world_get_score_of(this.__wbg_ptr,t)>>>0}get_best_input_weights(){const t=r.world_get_best_input_weights(this.__wbg_ptr);var n=A(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_best_output_weights(){const t=r.world_get_best_output_weights(this.__wbg_ptr);var n=A(t[0],t[1]).slice();return r.__wbindgen_free(t[0],t[1]*4,4),n}get_best_bias(){return r.world_get_best_bias(this.__wbg_ptr)}set_best_weights(t){const n=E(t,r.__wbindgen_malloc),o=M;r.world_set_best_weights(this.__wbg_ptr,n,o)}set_best_bias(t){r.world_set_best_bias(this.__wbg_ptr,t)}count_alive(){return r.world_count_alive(this.__wbg_ptr)>>>0}get_average_score(){return r.world_get_average_score(this.__wbg_ptr)}is_alive(t){return r.world_is_alive(this.__wbg_ptr,t)!==0}get_population_size(){return r.world_get_population_size(this.__wbg_ptr)>>>0}get_dino_x(t){return r.world_get_dino_x(this.__wbg_ptr,t)}get_dino_y(t){return r.world_get_dino_y(this.__wbg_ptr,t)}}async function I(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(o){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function P(){const e={};return e.wbg={},e.wbg.__wbg_log_c222819a41e063d3=function(t){console.log(t)},e.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_export_0,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_string_new=function(t,n){return x(t,n)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(x(t,n))},e}function q(e,t){return r=e.exports,S.__wbindgen_wasm_module=t,d=null,w=null,u=null,r.__wbindgen_start(),r}async function S(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/robo-dino/assets/rust_dino_bg-C2az293a.wasm",import.meta.url));const t=P();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await I(await e,t);return q(n,o)}let c;const m=document.getElementById("main"),_=m.getContext("2d"),b=document.getElementById("fitness"),g=b.getContext("2d");let y=[];const h=document.getElementById("weightsCanvas"),p=h.getContext("2d");function B(e){const t=(e+1)/2,n=Math.floor(t*255),o=Math.floor((1-t)*255);return`rgb(${n}, 0, ${o})`}function D(){const e=c.get_best_input_weights(),t=3,n=e.length/t,o=h.width/t,i=h.height/n;p.clearRect(0,0,h.width,h.height);for(let s=0;s<e.length;s++){const a=Math.floor(s/t),l=s%t;p.fillStyle=B(e[s]),p.fillRect(l*o,a*i,o,i)}}function N(){const e=m.width,t=m.height;_.clearRect(0,0,e,t),_.fillStyle="brown",_.fillRect(0,t-20,e,20);const n=c.get_population_size?.()??1;for(let s=0;s<n;s++){const a=c.is_alive(s),l=c.get_dino_x(s),T=c.get_dino_y(s),f=20,v=t-20-T-f;_.fillStyle=a?"green":"transparent",_.fillRect(l,v,f,f),a&&(_.save(),_.lineWidth=1,_.strokeStyle="white",_.strokeRect(l,v,f,f),_.restore())}for(let s=0;s<c.get_obstacle_count();s++){const a=c.get_obstacle_x(s);_.fillStyle="red",_.fillRect(a,t-20-30,20,30)}let o=0;for(let s=0;s<n;s++)c.is_alive(s)&&(o=Math.max(o,c.get_score_of(s)));const i=c.count_alive();_.fillStyle="black",_.font="14px monospace",_.fillText(`Score: ${o}`,10,20),_.fillText(`Alive: ${i}`,150,20)}function $(e){g.clearRect(0,0,b.width,b.height);const t=Math.max(...e,10),n=b.width,o=b.height;g.beginPath(),g.moveTo(0,o),e.forEach((i,s)=>{const a=s/e.length*n,l=o-i/t*o;g.lineTo(a,l)}),g.strokeStyle="blue",g.stroke()}function z(){c.update(1/60),N(),D();const e=c.get_best_score();y.push(e),y.length>100&&y.shift(),$(y),requestAnimationFrame(z);const t=c.count_alive();console.log("Alive (frontend):",t)}S().then(()=>{c=new U,requestAnimationFrame(z)});
