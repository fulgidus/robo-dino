(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();let s;const m=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&m.decode();let l=null;function M(){return(l===null||l.byteLength===0)&&(l=new Uint8Array(s.memory.buffer)),l}function L(t,e){return t=t>>>0,m.decode(M().subarray(t,t+e))}let _=null;function O(){return(_===null||_.byteLength===0)&&(_=new Uint32Array(s.memory.buffer)),_}function T(t,e){return t=t>>>0,O().subarray(t/4,t/4+e)}let g=null;function p(){return(g===null||g.byteLength===0)&&(g=new Float32Array(s.memory.buffer)),g}function I(t,e){return t=t>>>0,p().subarray(t/4,t/4+e)}let x=0;function U(t,e){const n=e(t.length*4,4)>>>0;return p().set(t,n/4),x=t.length,n}typeof FinalizationRegistry>"u"||new FinalizationRegistry(t=>s.__wbg_obstacle_free(t>>>0,1));const h=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_world_free(t>>>0,1));class B{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,h.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_world_free(e,0)}constructor(){const e=s.world_new();return this.__wbg_ptr=e>>>0,h.register(this,this.__wbg_ptr,this),this}update(e){s.world_update(this.__wbg_ptr,e)}get_best_dino_x(){return s.world_get_best_dino_x(this.__wbg_ptr)}get_best_dino_y(){return s.world_get_best_dino_y(this.__wbg_ptr)}get_best_score(){return s.world_get_best_score(this.__wbg_ptr)>>>0}get_generation(){return s.world_get_generation(this.__wbg_ptr)>>>0}get_obstacle_count(){return s.world_get_obstacle_count(this.__wbg_ptr)>>>0}get_obstacle_x(e){return s.world_get_obstacle_x(this.__wbg_ptr,e)}get_fitness_history(){const e=s.world_get_fitness_history(this.__wbg_ptr);var n=T(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),n}get_score(){return s.world_get_score(this.__wbg_ptr)>>>0}get_best_weights(){const e=s.world_get_best_weights(this.__wbg_ptr);var n=I(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),n}get_best_bias(){return s.world_get_best_bias(this.__wbg_ptr)}set_best_weights(e){const n=U(e,s.__wbindgen_malloc),r=x;s.world_set_best_weights(this.__wbg_ptr,n,r)}set_best_bias(e){s.world_set_best_bias(this.__wbg_ptr,e)}}async function C(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function N(){const t={};return t.wbg={},t.wbg.__wbindgen_init_externref_table=function(){const e=s.__wbindgen_export_0,n=e.grow(4);e.set(0,void 0),e.set(n+0,void 0),e.set(n+1,null),e.set(n+2,!0),e.set(n+3,!1)},t.wbg.__wbindgen_throw=function(e,n){throw new Error(L(e,n))},t}function z(t,e){return s=t.exports,A.__wbindgen_wasm_module=e,g=null,_=null,l=null,s.__wbindgen_start(),s}async function A(t){if(s!==void 0)return s;typeof t<"u"&&(Object.getPrototypeOf(t)===Object.prototype?{module_or_path:t}=t:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof t>"u"&&(t=new URL("/robo-dino/assets/rust_dino_bg-CrVUMnJd.wasm",import.meta.url));const e=N();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await C(await t,e);return z(n,r)}const P=16,y=[],f=document.getElementById("fitness"),a=f.getContext("2d");let b=[];function q(t){const e=t.get_best_weights(),n=t.get_best_bias(),r={weights:e,bias:n};localStorage.setItem("best_brain",JSON.stringify(r))}function D(){const t=localStorage.getItem("best_brain");return t?JSON.parse(t):null}function H(){const t=document.getElementById("grid");for(let e=0;e<P;e++){const n=document.createElement("canvas");n.width=300,n.height=100,t.appendChild(n),y.push({canvas:n,ctx:n.getContext("2d"),world:null})}}function j(t){const{ctx:e,world:n,canvas:r}=t;e.clearRect(0,0,r.width,r.height);const i=20,o=20,c=20,u=20,d=30;e.fillStyle="brown",e.fillRect(0,r.height-i,r.width,i);const S=n.get_best_dino_x(),F=n.get_best_dino_y(),W=r.height-i-F-c;e.fillStyle="green",e.fillRect(S,W,o,c);for(let w=0;w<n.get_obstacle_count();w++){const R=n.get_obstacle_x(w),E=r.height-i-d;e.fillStyle="red",e.fillRect(R,E,u,d)}e.fillStyle="black",e.font="12px monospace",e.fillText(`Score: ${n.get_score()}`,5,12)}function k(t){a.clearRect(0,0,f.width,f.height);const e=Math.max(...t,10),n=f.width,r=f.height;a.beginPath(),a.moveTo(0,r),t.forEach((o,c)=>{const u=c/t.length*n,d=r-o/e*r;a.lineTo(u,d)}),a.strokeStyle="blue",a.lineWidth=2,a.stroke(),a.strokeStyle="gray";const i=r-Math.max(...t)/e*r;a.beginPath(),a.moveTo(0,i),a.lineTo(n,i),a.stroke()}function v(){const t=.016666666666666666;let e=0,n=null;for(const r of y){r.world.update(t),j(r);const i=r.world.get_score();i>e&&(e=i,n=r.world)}n&&q(n),b.push(e),b.length>100&&b.shift(),k(b),requestAnimationFrame(v)}A().then(()=>{H();for(const t of y){t.world=new B;const e=D();e&&(t.world.set_best_weights(Float32Array.from(e.weights)),t.world.set_best_bias(e.bias))}document.getElementById("reset-learning").addEventListener("click",()=>{localStorage.removeItem("best_brain"),location.reload()}),document.getElementById("clear-data").addEventListener("click",()=>{localStorage.removeItem("best_brain"),alert("Saved data cleared!")}),requestAnimationFrame(v)});
